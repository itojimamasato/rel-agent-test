# AGENT-One 要件定義書

**バージョン**: 1.0  
**作成日**: 2025年1月  
**ステータス**: MVP開発中

---

## 1. 概要

### 1.1 コンセプト

AGENT-Oneは、**アプリ保守に特化したAIエージェント**である。利用者は営業担当やエンジニアで、既存アプリケーションについての様々な調査をAIに依頼できる。

### 1.2 解決する課題

| 課題 | AGENT-Oneによる解決 |
|------|---------------------|
| ソースコード理解に時間がかかる | AIがコードを解析し、機能の使い方を説明 |
| 工数見積りの属人化 | AIが作業分解と工数算出を支援 |
| バグ調査の効率化 | GitHub IssueとコードをAIが横断的に調査 |

### 1.3 対象ユーザー

- 営業担当：顧客への見積り提示時に利用
- エンジニア：保守作業の調査・見積りに利用

---

## 2. ユースケース

### 2.1 既存アプリケーション利用方法調査

**概要**: チャット画面で機能の利用方法を質問すると、ソースコードを解析して使い方を説明する。

**フロー**:
```
1. ユーザーがプロジェクトを選択
2. 「このアプリケーションの〇〇機能の利用方法を教えて」と入力
3. AIがGitHub経由でソースコードを取得
4. AIがコードを解析し、利用方法を回答
```

**入力例**:
> このアプリケーションの検索機能の利用方法を教えて

**出力例**:
> 検索機能は以下の手順で利用できます：
> 1. ヘッダーの検索アイコンをクリック
> 2. キーワードを入力してEnter
> 3. 結果一覧から該当項目を選択
> 
> 技術的には `SearchController.java` の `search()` メソッドが...

---

### 2.2 機能追加の工数見積り

**概要**: 機能追加の依頼に対し、必要な作業内容と工数を見積もる。

**フロー**:
```
1. ユーザーがプロジェクトを選択
2. 「〇〇機能を追加する場合の工数を見積もって」と入力
3. AIがソースコードを解析
4. AIが作業内容一覧と各工数を回答
```

**入力例**:
> このアプリケーションにCSVエクスポート機能を追加する場合、必要な対応とどれくらいの工数がかかるのか見積もって

**出力例**:
> ## 作業内容と工数見積り
> 
> | 作業項目 | 工数 | 備考 |
> |---------|------|------|
> | API設計・実装 | 4h | ExportController新規作成 |
> | CSV生成ロジック | 3h | Apache Commons CSV利用 |
> | UI実装（ボタン追加） | 2h | 一覧画面に追加 |
> | 単体テスト | 2h | - |
> | 結合テスト | 1h | - |
> | **合計** | **12h** | |

---

### 2.3 バグ調査

**概要**: GitHub Issueを指定し、バグ修正に必要な対応内容と工数を見積もる。

**フロー**:
```
1. ユーザーがプロジェクトを選択
2. 「Issue #123 のバグ修正に必要な対応と工数を見積もって」と入力
3. AIがIssue内容を取得
4. AIが関連コードを解析
5. AIが修正方針と工数を回答
```

**入力例**:
> Issue #45 のバグ修正に必要な対応内容と工数を見積って

**出力例**:
> ## Issue #45: ログイン時にエラーが発生する
> 
> ### 原因分析
> `AuthService.java` の `authenticate()` メソッドで、null チェックが不足しています。
> 
> ### 修正内容と工数
> | 作業項目 | 工数 | 備考 |
> |---------|------|------|
> | 原因調査（完了） | - | 上記の通り |
> | コード修正 | 1h | null チェック追加 |
> | 単体テスト追加 | 1h | 境界値テスト |
> | **合計** | **2h** | |

---

## 3. 機能要件（MVP）

### 3.1 プロジェクト管理機能

| 機能 | 説明 |
|------|------|
| プロジェクト作成 | 名前、説明、リポジトリURLを登録 |
| プロジェクト一覧 | 登録済みプロジェクトを一覧表示 |
| プロジェクト編集 | 登録情報の変更 |
| プロジェクト削除 | プロジェクトと関連データの削除 |
| プロジェクト切り替え | チャット対象のプロジェクトを選択 |

**プロジェクト情報**:
```typescript
interface Project {
  id: string;
  name: string;           // プロジェクト名
  description: string;    // 説明
  repositoryUrl: string;  // GitHubリポジトリURL
  githubToken?: string;   // Personal Access Token
  createdAt: string;
  updatedAt: string;
}
```

---

### 3.2 AIチャット機能

| 機能 | 説明 |
|------|------|
| メッセージ送信 | ユーザーがAIに質問・依頼を送信 |
| AI応答表示 | AIの回答をリアルタイム表示 |
| 会話履歴表示 | 現在のセッションの会話履歴を表示 |
| Markdown対応 | AI応答のMarkdownをレンダリング |

**チャットメッセージ**:
```typescript
interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: string;
  isLoading?: boolean;
}
```

---

### 3.3 GitHub連携機能（MCP）

| 機能 | 説明 |
|------|------|
| リポジトリ接続 | Personal Access Tokenで認証 |
| コード取得 | 対象リポジトリのソースコードを取得 |
| Issue取得 | Issue一覧・詳細を取得 |

**認証方式**: Personal Access Token（PAT）
- ユーザーがGitHubで発行したトークンをプロジェクト設定で入力
- トークンはlocalStorageに保存（MVP仕様）

---

## 4. 非機能要件

### 4.1 性能要件

| 項目 | 要件 |
|------|------|
| 応答時間 | AI応答開始まで5秒以内（ストリーミング） |
| 同時接続 | MVP: 単一ユーザー想定 |

### 4.2 セキュリティ要件

| 項目 | MVP対応 | 将来対応 |
|------|---------|----------|
| ユーザー認証 | なし | Clerk導入 |
| APIキー管理 | localStorage | 暗号化 or Secrets Manager |
| 通信暗号化 | HTTPS | HTTPS |

### 4.3 運用要件

| 項目 | 要件 |
|------|------|
| デプロイ先 | Railway |
| 監視 | Railway標準ログ |
| バックアップ | なし（localStorage利用のため） |

---

## 5. 技術仕様

### 5.1 技術スタック

| 項目 | 技術 | バージョン |
|------|------|-----------|
| ランタイム | Node.js | v20 LTS |
| フレームワーク | Next.js (App Router) | v15 |
| 言語 | TypeScript | 5.x |
| スタイリング | Tailwind CSS | v4 |
| 状態管理 | React hooks + Context | - |
| AI実行 | Claude Code CLI | 最新 |
| GitHub連携 | GitHub MCP Server | - |

### 5.2 アーキテクチャ

```
┌─────────────────────────────────────────────────────────┐
│                    Railway                              │
│  ┌───────────────────────────────────────────────────┐  │
│  │              Next.js Application                  │  │
│  │  ┌─────────────────┐  ┌─────────────────────────┐ │  │
│  │  │   Frontend      │  │      Backend            │ │  │
│  │  │   (React)       │  │   (API Routes)          │ │  │
│  │  │                 │  │         │               │ │  │
│  │  │  チャットUI     │◄─┤  POST /api/chat         │ │  │
│  │  │  プロジェクト管理│  │         │               │ │  │
│  │  └─────────────────┘  │         ▼               │ │  │
│  │                       │  ┌─────────────────┐    │ │  │
│  │                       │  │  Claude Code    │    │ │  │
│  │                       │  │  (Headless)     │    │ │  │
│  │                       │  └────────┬────────┘    │ │  │
│  │                       └───────────┼─────────────┘ │  │
│  └───────────────────────────────────┼───────────────┘  │
└─────────────────────────────────────────────────────────┘
                                       │
                                       ▼
                            ┌─────────────────────┐
                            │      GitHub         │
                            │  (MCP Server連携)   │
                            │  - リポジトリ       │
                            │  - Issue            │
                            └─────────────────────┘
```

### 5.3 ディレクトリ構成

```
agent-one/
├── src/
│   ├── app/
│   │   ├── page.tsx              # メインページ（チャットUI）
│   │   ├── layout.tsx            # 共通レイアウト
│   │   └── api/
│   │       └── chat/
│   │           └── route.ts      # Chat API エンドポイント
│   ├── components/
│   │   ├── ChatInput.tsx         # メッセージ入力
│   │   ├── ChatArea.tsx          # チャットエリア
│   │   ├── MessageBubble.tsx     # メッセージ表示
│   │   ├── ProjectList.tsx       # プロジェクト一覧
│   │   └── ProjectModal.tsx      # プロジェクト作成/編集
│   ├── lib/
│   │   ├── storage.ts            # localStorage操作
│   │   └── claude.ts             # Claude Code連携
│   └── types/
│       └── index.ts              # 型定義
├── docs/
│   └── REQUIREMENTS.md           # 本ドキュメント
└── package.json
```

---

## 6. 画面設計

### 6.1 画面構成

```
┌─────────────────────────────────────────────────────────┐
│  AGENT-One                      [プロジェクト選択 ▼]    │
├─────────────┬───────────────────────────────────────────┤
│             │                                           │
│ プロジェクト │            チャットエリア                 │
│ 一覧        │                                           │
│             │  ┌─────────────────────────────────────┐  │
│ ─────────── │  │ 👤 このアプリの検索機能の            │  │
│ > Project A │  │    使い方を教えて                    │  │
│   Project B │  ├─────────────────────────────────────┤  │
│             │  │ 🤖 検索機能について解析しました...   │  │
│ [+ 新規]    │  │                                     │  │
│             │  └─────────────────────────────────────┘  │
│             │                                           │
│             │  ┌─────────────────────────────────────┐  │
│             │  │ メッセージを入力...          [送信] │  │
│             │  └─────────────────────────────────────┘  │
└─────────────┴───────────────────────────────────────────┘
```

### 6.2 画面一覧

| 画面 | 機能 |
|------|------|
| メイン画面 | プロジェクト一覧 + チャット |
| プロジェクト作成モーダル | 新規プロジェクト登録 |
| プロジェクト編集モーダル | プロジェクト情報変更 |
| 設定モーダル（将来） | GitHub Token設定等 |

---

## 7. データ設計

### 7.1 データ保存先

| データ | 保存先 | 備考 |
|--------|--------|------|
| プロジェクト情報 | localStorage | `agent-one-projects` |
| 現在のプロジェクトID | localStorage | `agent-one-current-project` |
| チャットセッション | localStorage | `agent-one-sessions` |

### 7.2 データ構造

```typescript
// localStorage: agent-one-projects
Project[]

// localStorage: agent-one-current-project
string (projectId)

// localStorage: agent-one-sessions
ChatSession[]
```

---

## 8. API設計

### 8.1 エンドポイント一覧

| メソッド | パス | 説明 |
|---------|------|------|
| POST | `/api/chat` | AIにメッセージを送信 |

### 8.2 POST /api/chat

**リクエスト**:
```typescript
interface ChatRequest {
  message: string;      // ユーザーのメッセージ
  projectId: string;    // 対象プロジェクトID
  sessionId?: string;   // 会話継続時のセッションID
}
```

**レスポンス**:
```typescript
interface ChatResponse {
  message: string;      // AIの応答
  sessionId: string;    // セッションID
  error?: string;       // エラーメッセージ
}
```

---

## 9. 将来拡張

### 9.1 Phase 2（認証追加）

- Clerk による認証機能
- ユーザーごとのプロジェクト管理
- データベース導入（PostgreSQL等）

### 9.2 Phase 3（機能拡張）

- GitLab/Bitbucket対応
- チャット履歴の永続化・検索
- レポート出力機能（PDF/Excel）
- チーム共有機能

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| MCP | Model Context Protocol。AIとツールを接続するプロトコル |
| Claude Code | Anthropic社のAIコーディングツール |
| PAT | Personal Access Token。GitHub APIの認証トークン |
| Railway | PaaSサービス。アプリのホスティング先 |

---

## 改訂履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025年1月 | 1.0 | 初版作成 |